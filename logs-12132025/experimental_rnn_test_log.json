{"created": 1765570365.193766, "duration": 96.29089713096619, "exitcode": 1, "root": "/dockerx/rocm/rocm-jax/jax", "environment": {}, "summary": {"failed": 5, "skipped": 7, "passed": 10, "total": 22, "collected": 22}, "collectors": [{"nodeid": "", "outcome": "passed", "result": [{"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm0", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm1", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm2", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm3", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm4", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm5", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm6", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm7", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm8", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm9", "type": "TestCaseFunction", "lineno": 28}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref0", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref1", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref2", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref3", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref4", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref5", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref6", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref7", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref8", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref9", "type": "TestCaseFunction", "lineno": 117}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_no_workspace_overflow", "type": "TestCaseFunction", "lineno": 218}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_struct_encoding_determinism", "type": "TestCaseFunction", "lineno": 181}]}], "tests": [{"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm0", "lineno": 28, "outcome": "failed", "keywords": ["test_lstm0", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00022201798856258392, "outcome": "passed"}, "call": {"duration": 0.17216393910348415, "outcome": "failed", "crash": {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'"}, "traceback": [{"path": "jax/tests/experimental_rnn_test.py", "lineno": 81, "message": ""}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 368, "message": "in check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 355, "message": "in _check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 305, "message": "in check_vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2176, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2190, "message": "in _vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 313, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 287, "message": "in linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 261, "message": "in direct_linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 90, "message": "in flatten_fun_nokwargs"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "jax/tests/experimental_rnn_test.py", "lineno": 65, "message": "in f"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 749, "message": "in __call__"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 1007, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 979, "message": "in process_custom_vjp_call"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 850, "message": "in _flatten_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 292, "message": "in _argnums_partial"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 425, "message": "in lstm_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 1189, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 94, "message": "in apply_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 263, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 136, "message": "in _python_pjit_helper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 630, "message": "in _infer_params"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 655, "message": "in _infer_params_internal"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 551, "message": "in _infer_params_impl"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 496, "message": "in memoized_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 1182, "message": "in _create_pjit_jaxpr"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py", "lineno": 359, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2483, "message": "in trace_to_jaxpr_dynamic"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 73, "message": "in flatten_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 121, "message": "in prim_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2175, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2189, "message": "in default_process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 460, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 444, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2004, "message": "in _cached_abstract_eval"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 702, "message": "in abstract_eval_"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError"}], "longrepr": "self = <tests.experimental_rnn_test.RnnTest testMethod=test_lstm0>\nbatch_size = 1, seq_len = 1, input_size = 2, hidden_size = 1, num_layers = 4\nbidirectional = False\n\n    @jtu.sample_product(\n        batch_size=[1, 4],\n        seq_len=[1, 4],\n        input_size=[1, 2],\n        hidden_size=[1, 6],\n        num_layers=[1, 4],\n        bidirectional=[True, False],\n    )\n    @jtu.run_on_devices(\"cuda\", \"rocm\")\n    @jax.default_matmul_precision(\"float32\")\n    def test_lstm(self, batch_size: int, seq_len: int, input_size: int,\n                  hidden_size: int, num_layers: int, bidirectional: bool):\n      # TODO(ruturaj4): Bidirectional doesn't quite work well with rocm.\n      if bidirectional and jtu.is_device_rocm():\n        self.skipTest(\"Bidirectional mode is not available for ROCm.\")\n    \n      num_directions = 2 if bidirectional else 1\n      seq_length_key, root_key = jax.random.split(jax.random.PRNGKey(0))\n    \n      seq_lengths = jax.random.randint(\n        seq_length_key, (batch_size,), 1, seq_len, dtype=jnp.int32)\n    \n      k1, k2, k3, k4 = jax.random.split(root_key, 4)\n      x = jax.random.normal(\n          k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n      h_0 = jax.random.normal(\n          k2, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      c_0 = jax.random.normal(\n          k3, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers,\n                                     bidirectional)\n      def f(weights, x, h_0, c_0):\n        if jtu.is_device_rocm():\n          weights = rnn.swap_lstm_gates(weights, input_size, hidden_size, num_layers, bidirectional)\n        y, h, c = rnn.lstm(\n          x,\n          h_0,\n          c_0,\n          weights,\n          seq_lengths=seq_lengths,\n          input_size=input_size,\n          hidden_size=hidden_size,\n          num_layers=num_layers,\n          dropout=False,\n          bidirectional=bidirectional)\n        seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None],\n            [batch_size, 1]) < seq_lengths[:, None]\n        loss = jnp.sum(jnp.where(seq_length_mask[..., None], y, 0.))\n        return loss, (y, h, c)\n    \n>     jtu.check_grads(f, (weights, x, h_0, c_0), modes=[\"rev\"], order=1, atol=5E-3, rtol=5E-3)\n\njax/tests/experimental_rnn_test.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:368: in check_grads\n    _check_grads(f, args, order)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:355: in _check_grads\n    _check_vjp(f, partial(api.vjp, f), args, err_msg=rev_msg)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:305: in check_vjp\n    v_out, vjpfun = f_vjp(*args)\n                    ^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2176: in vjp\n    return _vjp(wrapped_fun, *primals, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2190: in _vjp\n    out_primals, vjp = ad.vjp(flat_fun, primals_flat)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:313: in vjp\n    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)\n                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:287: in linearize\n    return direct_linearize(traceable, primals, kwargs, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:261: in direct_linearize\n    ans = traceable.call_wrapped(*tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:90: in flatten_fun_nokwargs\n    ans = f(*py_args)\n          ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\njax/tests/experimental_rnn_test.py:65: in f\n    y, h, c = rnn.lstm(\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:749: in __call__\n    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:1007: in bind_with_trace\n    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:979: in process_custom_vjp_call\n    res_and_primals_out = fwd.call_wrapped(*fwd_in_flat)\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:850: in _flatten_fwd\n    pair_out = f(*py_args)\n               ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:292: in _argnums_partial\n    return _fun(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:425: in lstm_fwd\n    y, h_n, c_n, reserve_space = rnn_fwd_p.bind(\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:1189: in process_primitive\n    return primitive.impl(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:94: in apply_primitive\n    outs = fun(*args)\n           ^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:263: in cache_miss\n    executable, pgle_profiler, const_args) = _python_pjit_helper(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:136: in _python_pjit_helper\n    p, args_flat = _infer_params(fun, jit_info, args, kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:630: in _infer_params\n    return _infer_params_internal(fun, ji, args, kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:655: in _infer_params_internal\n    p, args_flat = _infer_params_impl(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:551: in _infer_params_impl\n    jaxpr, consts, out_avals = _create_pjit_jaxpr(\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:496: in memoized_fun\n    ans = call(fun, *args)\n          ^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:1182: in _create_pjit_jaxpr\n    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(fun, in_type)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py:359: in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2483: in trace_to_jaxpr_dynamic\n    ans = fun.call_wrapped(*in_tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:73: in flatten_fun\n    ans = f(*py_args, **py_kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:121: in prim_fun\n    return prim.bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2175: in process_primitive\n    return self.default_process_primitive(\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2189: in default_process_primitive\n    out_avals, effs = _cached_abstract_eval(primitive, *aval_qdds, **params)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:460: in wrapper\n    return cached_call(_multi_weakref_placeholder,\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:444: in cache_miss\n    return call(*orig_args, **orig_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2004: in _cached_abstract_eval\n    return primitive.abstract_eval(*aval_qdds, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:702: in abstract_eval_\n    return abstract_eval(*args, **kwargs), no_effects\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nx_aval = ShapedArray(float32[1,1,2]), h_0_aval = ShapedArray(float32[4,1,1])\nc_0_aval = ShapedArray(float32[4,1,1]), w_aval = ShapedArray(float32[68])\nseq_lengths_aval = ShapedArray(int32[1]), input_size = 2, hidden_size = 1\nnum_layers = 4, dropout = False, bidirectional = False, cudnn_allow_tf32 = False\n\n    def rnn_abstract_eval(x_aval, h_0_aval, c_0_aval, w_aval, seq_lengths_aval,\n                          input_size: int, hidden_size: int, num_layers: int,\n                          dropout: float, bidirectional: bool,\n                          cudnn_allow_tf32: bool):\n      batch_size, max_seq_length = x_aval.shape[0], x_aval.shape[1]\n      num_directions = 2 if bidirectional else 1\n      output_shape = (batch_size, max_seq_length, num_directions * hidden_size)\n      output_aval = core.ShapedArray(output_shape, x_aval.dtype)\n      _, reserve_space_size = (\n>         gpu_rnn.compute_rnn_workspace_reserve_space_sizes(  # pytype: disable=attribute-error\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n              input_size, hidden_size, num_layers, batch_size, max_seq_length,\n              dropout, bidirectional, cudnn_allow_tf32))\nE     AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'\n\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:449: AttributeError"}, "teardown": {"duration": 0.00022676680237054825, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm1", "lineno": 28, "outcome": "failed", "keywords": ["test_lstm1", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00023389142006635666, "outcome": "passed"}, "call": {"duration": 0.1741989217698574, "outcome": "failed", "crash": {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'"}, "traceback": [{"path": "jax/tests/experimental_rnn_test.py", "lineno": 81, "message": ""}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 368, "message": "in check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 355, "message": "in _check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 305, "message": "in check_vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2176, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2190, "message": "in _vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 313, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 287, "message": "in linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 261, "message": "in direct_linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 90, "message": "in flatten_fun_nokwargs"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "jax/tests/experimental_rnn_test.py", "lineno": 65, "message": "in f"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 749, "message": "in __call__"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 1007, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 979, "message": "in process_custom_vjp_call"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 850, "message": "in _flatten_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 292, "message": "in _argnums_partial"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 425, "message": "in lstm_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 1189, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 94, "message": "in apply_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 263, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 136, "message": "in _python_pjit_helper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 630, "message": "in _infer_params"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 655, "message": "in _infer_params_internal"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 551, "message": "in _infer_params_impl"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 496, "message": "in memoized_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 1182, "message": "in _create_pjit_jaxpr"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py", "lineno": 359, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2483, "message": "in trace_to_jaxpr_dynamic"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 73, "message": "in flatten_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 121, "message": "in prim_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2175, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2189, "message": "in default_process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 460, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 444, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2004, "message": "in _cached_abstract_eval"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 702, "message": "in abstract_eval_"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError"}], "longrepr": "self = <tests.experimental_rnn_test.RnnTest testMethod=test_lstm1>\nbatch_size = 1, seq_len = 4, input_size = 1, hidden_size = 6, num_layers = 4\nbidirectional = False\n\n    @jtu.sample_product(\n        batch_size=[1, 4],\n        seq_len=[1, 4],\n        input_size=[1, 2],\n        hidden_size=[1, 6],\n        num_layers=[1, 4],\n        bidirectional=[True, False],\n    )\n    @jtu.run_on_devices(\"cuda\", \"rocm\")\n    @jax.default_matmul_precision(\"float32\")\n    def test_lstm(self, batch_size: int, seq_len: int, input_size: int,\n                  hidden_size: int, num_layers: int, bidirectional: bool):\n      # TODO(ruturaj4): Bidirectional doesn't quite work well with rocm.\n      if bidirectional and jtu.is_device_rocm():\n        self.skipTest(\"Bidirectional mode is not available for ROCm.\")\n    \n      num_directions = 2 if bidirectional else 1\n      seq_length_key, root_key = jax.random.split(jax.random.PRNGKey(0))\n    \n      seq_lengths = jax.random.randint(\n        seq_length_key, (batch_size,), 1, seq_len, dtype=jnp.int32)\n    \n      k1, k2, k3, k4 = jax.random.split(root_key, 4)\n      x = jax.random.normal(\n          k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n      h_0 = jax.random.normal(\n          k2, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      c_0 = jax.random.normal(\n          k3, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers,\n                                     bidirectional)\n      def f(weights, x, h_0, c_0):\n        if jtu.is_device_rocm():\n          weights = rnn.swap_lstm_gates(weights, input_size, hidden_size, num_layers, bidirectional)\n        y, h, c = rnn.lstm(\n          x,\n          h_0,\n          c_0,\n          weights,\n          seq_lengths=seq_lengths,\n          input_size=input_size,\n          hidden_size=hidden_size,\n          num_layers=num_layers,\n          dropout=False,\n          bidirectional=bidirectional)\n        seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None],\n            [batch_size, 1]) < seq_lengths[:, None]\n        loss = jnp.sum(jnp.where(seq_length_mask[..., None], y, 0.))\n        return loss, (y, h, c)\n    \n>     jtu.check_grads(f, (weights, x, h_0, c_0), modes=[\"rev\"], order=1, atol=5E-3, rtol=5E-3)\n\njax/tests/experimental_rnn_test.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:368: in check_grads\n    _check_grads(f, args, order)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:355: in _check_grads\n    _check_vjp(f, partial(api.vjp, f), args, err_msg=rev_msg)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:305: in check_vjp\n    v_out, vjpfun = f_vjp(*args)\n                    ^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2176: in vjp\n    return _vjp(wrapped_fun, *primals, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2190: in _vjp\n    out_primals, vjp = ad.vjp(flat_fun, primals_flat)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:313: in vjp\n    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)\n                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:287: in linearize\n    return direct_linearize(traceable, primals, kwargs, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:261: in direct_linearize\n    ans = traceable.call_wrapped(*tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:90: in flatten_fun_nokwargs\n    ans = f(*py_args)\n          ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\njax/tests/experimental_rnn_test.py:65: in f\n    y, h, c = rnn.lstm(\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:749: in __call__\n    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:1007: in bind_with_trace\n    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:979: in process_custom_vjp_call\n    res_and_primals_out = fwd.call_wrapped(*fwd_in_flat)\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:850: in _flatten_fwd\n    pair_out = f(*py_args)\n               ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:292: in _argnums_partial\n    return _fun(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:425: in lstm_fwd\n    y, h_n, c_n, reserve_space = rnn_fwd_p.bind(\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:1189: in process_primitive\n    return primitive.impl(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:94: in apply_primitive\n    outs = fun(*args)\n           ^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:263: in cache_miss\n    executable, pgle_profiler, const_args) = _python_pjit_helper(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:136: in _python_pjit_helper\n    p, args_flat = _infer_params(fun, jit_info, args, kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:630: in _infer_params\n    return _infer_params_internal(fun, ji, args, kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:655: in _infer_params_internal\n    p, args_flat = _infer_params_impl(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:551: in _infer_params_impl\n    jaxpr, consts, out_avals = _create_pjit_jaxpr(\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:496: in memoized_fun\n    ans = call(fun, *args)\n          ^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:1182: in _create_pjit_jaxpr\n    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(fun, in_type)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py:359: in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2483: in trace_to_jaxpr_dynamic\n    ans = fun.call_wrapped(*in_tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:73: in flatten_fun\n    ans = f(*py_args, **py_kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:121: in prim_fun\n    return prim.bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2175: in process_primitive\n    return self.default_process_primitive(\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2189: in default_process_primitive\n    out_avals, effs = _cached_abstract_eval(primitive, *aval_qdds, **params)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:460: in wrapper\n    return cached_call(_multi_weakref_placeholder,\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:444: in cache_miss\n    return call(*orig_args, **orig_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2004: in _cached_abstract_eval\n    return primitive.abstract_eval(*aval_qdds, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:702: in abstract_eval_\n    return abstract_eval(*args, **kwargs), no_effects\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nx_aval = ShapedArray(float32[1,4,1]), h_0_aval = ShapedArray(float32[4,1,6])\nc_0_aval = ShapedArray(float32[4,1,6]), w_aval = ShapedArray(float32[1224])\nseq_lengths_aval = ShapedArray(int32[1]), input_size = 1, hidden_size = 6\nnum_layers = 4, dropout = False, bidirectional = False, cudnn_allow_tf32 = False\n\n    def rnn_abstract_eval(x_aval, h_0_aval, c_0_aval, w_aval, seq_lengths_aval,\n                          input_size: int, hidden_size: int, num_layers: int,\n                          dropout: float, bidirectional: bool,\n                          cudnn_allow_tf32: bool):\n      batch_size, max_seq_length = x_aval.shape[0], x_aval.shape[1]\n      num_directions = 2 if bidirectional else 1\n      output_shape = (batch_size, max_seq_length, num_directions * hidden_size)\n      output_aval = core.ShapedArray(output_shape, x_aval.dtype)\n      _, reserve_space_size = (\n>         gpu_rnn.compute_rnn_workspace_reserve_space_sizes(  # pytype: disable=attribute-error\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n              input_size, hidden_size, num_layers, batch_size, max_seq_length,\n              dropout, bidirectional, cudnn_allow_tf32))\nE     AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'\n\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:449: AttributeError"}, "teardown": {"duration": 0.00024457648396492004, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm2", "lineno": 28, "outcome": "skipped", "keywords": ["test_lstm2", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00022676866501569748, "outcome": "passed"}, "call": {"duration": 0.000558014027774334, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 29, 'Skipped: Bidirectional mode is not available for ROCm.')"}, "teardown": {"duration": 9.379349648952484e-05, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm3", "lineno": 28, "outcome": "failed", "keywords": ["test_lstm3", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00022795423865318298, "outcome": "passed"}, "call": {"duration": 0.05103335529565811, "outcome": "failed", "crash": {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'"}, "traceback": [{"path": "jax/tests/experimental_rnn_test.py", "lineno": 81, "message": ""}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 368, "message": "in check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 355, "message": "in _check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 305, "message": "in check_vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2176, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2190, "message": "in _vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 313, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 287, "message": "in linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 261, "message": "in direct_linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 90, "message": "in flatten_fun_nokwargs"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "jax/tests/experimental_rnn_test.py", "lineno": 65, "message": "in f"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 749, "message": "in __call__"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 1007, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 979, "message": "in process_custom_vjp_call"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 850, "message": "in _flatten_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 292, "message": "in _argnums_partial"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 425, "message": "in lstm_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 1189, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 94, "message": "in apply_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 263, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 136, "message": "in _python_pjit_helper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 630, "message": "in _infer_params"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 655, "message": "in _infer_params_internal"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 551, "message": "in _infer_params_impl"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 496, "message": "in memoized_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 1182, "message": "in _create_pjit_jaxpr"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py", "lineno": 359, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2483, "message": "in trace_to_jaxpr_dynamic"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 73, "message": "in flatten_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 121, "message": "in prim_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2175, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2189, "message": "in default_process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 460, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 444, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2004, "message": "in _cached_abstract_eval"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 702, "message": "in abstract_eval_"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError"}], "longrepr": "self = <tests.experimental_rnn_test.RnnTest testMethod=test_lstm3>\nbatch_size = 1, seq_len = 1, input_size = 2, hidden_size = 6, num_layers = 1\nbidirectional = False\n\n    @jtu.sample_product(\n        batch_size=[1, 4],\n        seq_len=[1, 4],\n        input_size=[1, 2],\n        hidden_size=[1, 6],\n        num_layers=[1, 4],\n        bidirectional=[True, False],\n    )\n    @jtu.run_on_devices(\"cuda\", \"rocm\")\n    @jax.default_matmul_precision(\"float32\")\n    def test_lstm(self, batch_size: int, seq_len: int, input_size: int,\n                  hidden_size: int, num_layers: int, bidirectional: bool):\n      # TODO(ruturaj4): Bidirectional doesn't quite work well with rocm.\n      if bidirectional and jtu.is_device_rocm():\n        self.skipTest(\"Bidirectional mode is not available for ROCm.\")\n    \n      num_directions = 2 if bidirectional else 1\n      seq_length_key, root_key = jax.random.split(jax.random.PRNGKey(0))\n    \n      seq_lengths = jax.random.randint(\n        seq_length_key, (batch_size,), 1, seq_len, dtype=jnp.int32)\n    \n      k1, k2, k3, k4 = jax.random.split(root_key, 4)\n      x = jax.random.normal(\n          k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n      h_0 = jax.random.normal(\n          k2, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      c_0 = jax.random.normal(\n          k3, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers,\n                                     bidirectional)\n      def f(weights, x, h_0, c_0):\n        if jtu.is_device_rocm():\n          weights = rnn.swap_lstm_gates(weights, input_size, hidden_size, num_layers, bidirectional)\n        y, h, c = rnn.lstm(\n          x,\n          h_0,\n          c_0,\n          weights,\n          seq_lengths=seq_lengths,\n          input_size=input_size,\n          hidden_size=hidden_size,\n          num_layers=num_layers,\n          dropout=False,\n          bidirectional=bidirectional)\n        seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None],\n            [batch_size, 1]) < seq_lengths[:, None]\n        loss = jnp.sum(jnp.where(seq_length_mask[..., None], y, 0.))\n        return loss, (y, h, c)\n    \n>     jtu.check_grads(f, (weights, x, h_0, c_0), modes=[\"rev\"], order=1, atol=5E-3, rtol=5E-3)\n\njax/tests/experimental_rnn_test.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:368: in check_grads\n    _check_grads(f, args, order)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:355: in _check_grads\n    _check_vjp(f, partial(api.vjp, f), args, err_msg=rev_msg)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:305: in check_vjp\n    v_out, vjpfun = f_vjp(*args)\n                    ^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2176: in vjp\n    return _vjp(wrapped_fun, *primals, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2190: in _vjp\n    out_primals, vjp = ad.vjp(flat_fun, primals_flat)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:313: in vjp\n    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)\n                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:287: in linearize\n    return direct_linearize(traceable, primals, kwargs, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:261: in direct_linearize\n    ans = traceable.call_wrapped(*tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:90: in flatten_fun_nokwargs\n    ans = f(*py_args)\n          ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\njax/tests/experimental_rnn_test.py:65: in f\n    y, h, c = rnn.lstm(\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:749: in __call__\n    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:1007: in bind_with_trace\n    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:979: in process_custom_vjp_call\n    res_and_primals_out = fwd.call_wrapped(*fwd_in_flat)\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:850: in _flatten_fwd\n    pair_out = f(*py_args)\n               ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:292: in _argnums_partial\n    return _fun(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:425: in lstm_fwd\n    y, h_n, c_n, reserve_space = rnn_fwd_p.bind(\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:1189: in process_primitive\n    return primitive.impl(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:94: in apply_primitive\n    outs = fun(*args)\n           ^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:263: in cache_miss\n    executable, pgle_profiler, const_args) = _python_pjit_helper(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:136: in _python_pjit_helper\n    p, args_flat = _infer_params(fun, jit_info, args, kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:630: in _infer_params\n    return _infer_params_internal(fun, ji, args, kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:655: in _infer_params_internal\n    p, args_flat = _infer_params_impl(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:551: in _infer_params_impl\n    jaxpr, consts, out_avals = _create_pjit_jaxpr(\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:496: in memoized_fun\n    ans = call(fun, *args)\n          ^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:1182: in _create_pjit_jaxpr\n    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(fun, in_type)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py:359: in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2483: in trace_to_jaxpr_dynamic\n    ans = fun.call_wrapped(*in_tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:73: in flatten_fun\n    ans = f(*py_args, **py_kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:121: in prim_fun\n    return prim.bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2175: in process_primitive\n    return self.default_process_primitive(\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2189: in default_process_primitive\n    out_avals, effs = _cached_abstract_eval(primitive, *aval_qdds, **params)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:460: in wrapper\n    return cached_call(_multi_weakref_placeholder,\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:444: in cache_miss\n    return call(*orig_args, **orig_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2004: in _cached_abstract_eval\n    return primitive.abstract_eval(*aval_qdds, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:702: in abstract_eval_\n    return abstract_eval(*args, **kwargs), no_effects\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nx_aval = ShapedArray(float32[1,1,2]), h_0_aval = ShapedArray(float32[1,1,6])\nc_0_aval = ShapedArray(float32[1,1,6]), w_aval = ShapedArray(float32[240])\nseq_lengths_aval = ShapedArray(int32[1]), input_size = 2, hidden_size = 6\nnum_layers = 1, dropout = False, bidirectional = False, cudnn_allow_tf32 = False\n\n    def rnn_abstract_eval(x_aval, h_0_aval, c_0_aval, w_aval, seq_lengths_aval,\n                          input_size: int, hidden_size: int, num_layers: int,\n                          dropout: float, bidirectional: bool,\n                          cudnn_allow_tf32: bool):\n      batch_size, max_seq_length = x_aval.shape[0], x_aval.shape[1]\n      num_directions = 2 if bidirectional else 1\n      output_shape = (batch_size, max_seq_length, num_directions * hidden_size)\n      output_aval = core.ShapedArray(output_shape, x_aval.dtype)\n      _, reserve_space_size = (\n>         gpu_rnn.compute_rnn_workspace_reserve_space_sizes(  # pytype: disable=attribute-error\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n              input_size, hidden_size, num_layers, batch_size, max_seq_length,\n              dropout, bidirectional, cudnn_allow_tf32))\nE     AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'\n\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:449: AttributeError"}, "teardown": {"duration": 0.0002255793660879135, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm4", "lineno": 28, "outcome": "skipped", "keywords": ["test_lstm4", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00022320542484521866, "outcome": "passed"}, "call": {"duration": 0.0005722614005208015, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 29, 'Skipped: Bidirectional mode is not available for ROCm.')"}, "teardown": {"duration": 9.735580533742905e-05, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm5", "lineno": 28, "outcome": "failed", "keywords": ["test_lstm5", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.0002362644299864769, "outcome": "passed"}, "call": {"duration": 0.04869325924664736, "outcome": "failed", "crash": {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'"}, "traceback": [{"path": "jax/tests/experimental_rnn_test.py", "lineno": 81, "message": ""}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 368, "message": "in check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 355, "message": "in _check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 305, "message": "in check_vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2176, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2190, "message": "in _vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 313, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 287, "message": "in linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 261, "message": "in direct_linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 90, "message": "in flatten_fun_nokwargs"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "jax/tests/experimental_rnn_test.py", "lineno": 65, "message": "in f"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 749, "message": "in __call__"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 1007, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 979, "message": "in process_custom_vjp_call"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 850, "message": "in _flatten_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 292, "message": "in _argnums_partial"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 425, "message": "in lstm_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 1189, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 94, "message": "in apply_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 263, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 136, "message": "in _python_pjit_helper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 630, "message": "in _infer_params"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 655, "message": "in _infer_params_internal"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 551, "message": "in _infer_params_impl"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 496, "message": "in memoized_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 1182, "message": "in _create_pjit_jaxpr"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py", "lineno": 359, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2483, "message": "in trace_to_jaxpr_dynamic"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 73, "message": "in flatten_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 121, "message": "in prim_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2175, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2189, "message": "in default_process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 460, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 444, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2004, "message": "in _cached_abstract_eval"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 702, "message": "in abstract_eval_"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError"}], "longrepr": "self = <tests.experimental_rnn_test.RnnTest testMethod=test_lstm5>\nbatch_size = 1, seq_len = 1, input_size = 2, hidden_size = 1, num_layers = 1\nbidirectional = False\n\n    @jtu.sample_product(\n        batch_size=[1, 4],\n        seq_len=[1, 4],\n        input_size=[1, 2],\n        hidden_size=[1, 6],\n        num_layers=[1, 4],\n        bidirectional=[True, False],\n    )\n    @jtu.run_on_devices(\"cuda\", \"rocm\")\n    @jax.default_matmul_precision(\"float32\")\n    def test_lstm(self, batch_size: int, seq_len: int, input_size: int,\n                  hidden_size: int, num_layers: int, bidirectional: bool):\n      # TODO(ruturaj4): Bidirectional doesn't quite work well with rocm.\n      if bidirectional and jtu.is_device_rocm():\n        self.skipTest(\"Bidirectional mode is not available for ROCm.\")\n    \n      num_directions = 2 if bidirectional else 1\n      seq_length_key, root_key = jax.random.split(jax.random.PRNGKey(0))\n    \n      seq_lengths = jax.random.randint(\n        seq_length_key, (batch_size,), 1, seq_len, dtype=jnp.int32)\n    \n      k1, k2, k3, k4 = jax.random.split(root_key, 4)\n      x = jax.random.normal(\n          k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n      h_0 = jax.random.normal(\n          k2, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      c_0 = jax.random.normal(\n          k3, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers,\n                                     bidirectional)\n      def f(weights, x, h_0, c_0):\n        if jtu.is_device_rocm():\n          weights = rnn.swap_lstm_gates(weights, input_size, hidden_size, num_layers, bidirectional)\n        y, h, c = rnn.lstm(\n          x,\n          h_0,\n          c_0,\n          weights,\n          seq_lengths=seq_lengths,\n          input_size=input_size,\n          hidden_size=hidden_size,\n          num_layers=num_layers,\n          dropout=False,\n          bidirectional=bidirectional)\n        seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None],\n            [batch_size, 1]) < seq_lengths[:, None]\n        loss = jnp.sum(jnp.where(seq_length_mask[..., None], y, 0.))\n        return loss, (y, h, c)\n    \n>     jtu.check_grads(f, (weights, x, h_0, c_0), modes=[\"rev\"], order=1, atol=5E-3, rtol=5E-3)\n\njax/tests/experimental_rnn_test.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:368: in check_grads\n    _check_grads(f, args, order)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:355: in _check_grads\n    _check_vjp(f, partial(api.vjp, f), args, err_msg=rev_msg)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:305: in check_vjp\n    v_out, vjpfun = f_vjp(*args)\n                    ^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2176: in vjp\n    return _vjp(wrapped_fun, *primals, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2190: in _vjp\n    out_primals, vjp = ad.vjp(flat_fun, primals_flat)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:313: in vjp\n    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)\n                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:287: in linearize\n    return direct_linearize(traceable, primals, kwargs, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:261: in direct_linearize\n    ans = traceable.call_wrapped(*tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:90: in flatten_fun_nokwargs\n    ans = f(*py_args)\n          ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\njax/tests/experimental_rnn_test.py:65: in f\n    y, h, c = rnn.lstm(\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:749: in __call__\n    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:1007: in bind_with_trace\n    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:979: in process_custom_vjp_call\n    res_and_primals_out = fwd.call_wrapped(*fwd_in_flat)\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:850: in _flatten_fwd\n    pair_out = f(*py_args)\n               ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:292: in _argnums_partial\n    return _fun(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:425: in lstm_fwd\n    y, h_n, c_n, reserve_space = rnn_fwd_p.bind(\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:1189: in process_primitive\n    return primitive.impl(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:94: in apply_primitive\n    outs = fun(*args)\n           ^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:263: in cache_miss\n    executable, pgle_profiler, const_args) = _python_pjit_helper(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:136: in _python_pjit_helper\n    p, args_flat = _infer_params(fun, jit_info, args, kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:630: in _infer_params\n    return _infer_params_internal(fun, ji, args, kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:655: in _infer_params_internal\n    p, args_flat = _infer_params_impl(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:551: in _infer_params_impl\n    jaxpr, consts, out_avals = _create_pjit_jaxpr(\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:496: in memoized_fun\n    ans = call(fun, *args)\n          ^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:1182: in _create_pjit_jaxpr\n    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(fun, in_type)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py:359: in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2483: in trace_to_jaxpr_dynamic\n    ans = fun.call_wrapped(*in_tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:73: in flatten_fun\n    ans = f(*py_args, **py_kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:121: in prim_fun\n    return prim.bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2175: in process_primitive\n    return self.default_process_primitive(\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2189: in default_process_primitive\n    out_avals, effs = _cached_abstract_eval(primitive, *aval_qdds, **params)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:460: in wrapper\n    return cached_call(_multi_weakref_placeholder,\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:444: in cache_miss\n    return call(*orig_args, **orig_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2004: in _cached_abstract_eval\n    return primitive.abstract_eval(*aval_qdds, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:702: in abstract_eval_\n    return abstract_eval(*args, **kwargs), no_effects\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nx_aval = ShapedArray(float32[1,1,2]), h_0_aval = ShapedArray(float32[1,1,1])\nc_0_aval = ShapedArray(float32[1,1,1]), w_aval = ShapedArray(float32[20])\nseq_lengths_aval = ShapedArray(int32[1]), input_size = 2, hidden_size = 1\nnum_layers = 1, dropout = False, bidirectional = False, cudnn_allow_tf32 = False\n\n    def rnn_abstract_eval(x_aval, h_0_aval, c_0_aval, w_aval, seq_lengths_aval,\n                          input_size: int, hidden_size: int, num_layers: int,\n                          dropout: float, bidirectional: bool,\n                          cudnn_allow_tf32: bool):\n      batch_size, max_seq_length = x_aval.shape[0], x_aval.shape[1]\n      num_directions = 2 if bidirectional else 1\n      output_shape = (batch_size, max_seq_length, num_directions * hidden_size)\n      output_aval = core.ShapedArray(output_shape, x_aval.dtype)\n      _, reserve_space_size = (\n>         gpu_rnn.compute_rnn_workspace_reserve_space_sizes(  # pytype: disable=attribute-error\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n              input_size, hidden_size, num_layers, batch_size, max_seq_length,\n              dropout, bidirectional, cudnn_allow_tf32))\nE     AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'\n\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:449: AttributeError"}, "teardown": {"duration": 0.00023032911121845245, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm6", "lineno": 28, "outcome": "skipped", "keywords": ["test_lstm6", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00024101510643959045, "outcome": "passed"}, "call": {"duration": 0.0005556400865316391, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 29, 'Skipped: Bidirectional mode is not available for ROCm.')"}, "teardown": {"duration": 9.735487401485443e-05, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm7", "lineno": 28, "outcome": "skipped", "keywords": ["test_lstm7", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00016502849757671356, "outcome": "passed"}, "call": {"duration": 0.0003585526719689369, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 29, 'Skipped: Bidirectional mode is not available for ROCm.')"}, "teardown": {"duration": 8.904561400413513e-05, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm8", "lineno": 28, "outcome": "skipped", "keywords": ["test_lstm8", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00015315692871809006, "outcome": "passed"}, "call": {"duration": 0.0003383699804544449, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 29, 'Skipped: Bidirectional mode is not available for ROCm.')"}, "teardown": {"duration": 8.666981011629105e-05, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm9", "lineno": 28, "outcome": "failed", "keywords": ["test_lstm9", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.000269508920609951, "outcome": "passed"}, "call": {"duration": 0.1774259377270937, "outcome": "failed", "crash": {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'"}, "traceback": [{"path": "jax/tests/experimental_rnn_test.py", "lineno": 81, "message": ""}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 368, "message": "in check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 355, "message": "in _check_grads"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py", "lineno": 305, "message": "in check_vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2176, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api.py", "lineno": 2190, "message": "in _vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 313, "message": "in vjp"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 287, "message": "in linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 261, "message": "in direct_linearize"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 90, "message": "in flatten_fun_nokwargs"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "jax/tests/experimental_rnn_test.py", "lineno": 65, "message": "in f"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 749, "message": "in __call__"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 1007, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py", "lineno": 979, "message": "in process_custom_vjp_call"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py", "lineno": 850, "message": "in _flatten_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 292, "message": "in _argnums_partial"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 425, "message": "in lstm_fwd"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 1189, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 94, "message": "in apply_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 263, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 136, "message": "in _python_pjit_helper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 630, "message": "in _infer_params"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 655, "message": "in _infer_params_internal"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 551, "message": "in _infer_params_impl"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 496, "message": "in memoized_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py", "lineno": 1182, "message": "in _create_pjit_jaxpr"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py", "lineno": 359, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2483, "message": "in trace_to_jaxpr_dynamic"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 212, "message": "in call_wrapped"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py", "lineno": 73, "message": "in flatten_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py", "lineno": 421, "message": "in _get_result_paths_thunk"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py", "lineno": 121, "message": "in prim_fun"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 632, "message": "in bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 648, "message": "in _true_bind"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 660, "message": "in bind_with_trace"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2175, "message": "in process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2189, "message": "in default_process_primitive"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 460, "message": "in wrapper"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/util.py", "lineno": 444, "message": "in cache_miss"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py", "lineno": 2004, "message": "in _cached_abstract_eval"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/_src/core.py", "lineno": 702, "message": "in abstract_eval_"}, {"path": "/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py", "lineno": 449, "message": "AttributeError"}], "longrepr": "self = <tests.experimental_rnn_test.RnnTest testMethod=test_lstm9>\nbatch_size = 4, seq_len = 1, input_size = 2, hidden_size = 6, num_layers = 4\nbidirectional = False\n\n    @jtu.sample_product(\n        batch_size=[1, 4],\n        seq_len=[1, 4],\n        input_size=[1, 2],\n        hidden_size=[1, 6],\n        num_layers=[1, 4],\n        bidirectional=[True, False],\n    )\n    @jtu.run_on_devices(\"cuda\", \"rocm\")\n    @jax.default_matmul_precision(\"float32\")\n    def test_lstm(self, batch_size: int, seq_len: int, input_size: int,\n                  hidden_size: int, num_layers: int, bidirectional: bool):\n      # TODO(ruturaj4): Bidirectional doesn't quite work well with rocm.\n      if bidirectional and jtu.is_device_rocm():\n        self.skipTest(\"Bidirectional mode is not available for ROCm.\")\n    \n      num_directions = 2 if bidirectional else 1\n      seq_length_key, root_key = jax.random.split(jax.random.PRNGKey(0))\n    \n      seq_lengths = jax.random.randint(\n        seq_length_key, (batch_size,), 1, seq_len, dtype=jnp.int32)\n    \n      k1, k2, k3, k4 = jax.random.split(root_key, 4)\n      x = jax.random.normal(\n          k1, (batch_size, seq_len, input_size), dtype=jnp.float32)\n      h_0 = jax.random.normal(\n          k2, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      c_0 = jax.random.normal(\n          k3, (num_directions * num_layers, batch_size, hidden_size),\n          dtype=jnp.float32)\n      weights = rnn.init_lstm_weight(k4, input_size, hidden_size, num_layers,\n                                     bidirectional)\n      def f(weights, x, h_0, c_0):\n        if jtu.is_device_rocm():\n          weights = rnn.swap_lstm_gates(weights, input_size, hidden_size, num_layers, bidirectional)\n        y, h, c = rnn.lstm(\n          x,\n          h_0,\n          c_0,\n          weights,\n          seq_lengths=seq_lengths,\n          input_size=input_size,\n          hidden_size=hidden_size,\n          num_layers=num_layers,\n          dropout=False,\n          bidirectional=bidirectional)\n        seq_length_mask = jnp.tile(jnp.arange(seq_len, dtype=jnp.int32)[None],\n            [batch_size, 1]) < seq_lengths[:, None]\n        loss = jnp.sum(jnp.where(seq_length_mask[..., None], y, 0.))\n        return loss, (y, h, c)\n    \n>     jtu.check_grads(f, (weights, x, h_0, c_0), modes=[\"rev\"], order=1, atol=5E-3, rtol=5E-3)\n\njax/tests/experimental_rnn_test.py:81: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:368: in check_grads\n    _check_grads(f, args, order)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:355: in _check_grads\n    _check_vjp(f, partial(api.vjp, f), args, err_msg=rev_msg)\n/usr/local/lib/python3.12/dist-packages/jax/_src/public_test_util.py:305: in check_vjp\n    v_out, vjpfun = f_vjp(*args)\n                    ^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2176: in vjp\n    return _vjp(wrapped_fun, *primals, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api.py:2190: in _vjp\n    out_primals, vjp = ad.vjp(flat_fun, primals_flat)\n                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:313: in vjp\n    out_primals, pvals, jaxpr, consts = linearize(traceable, *primals)\n                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:287: in linearize\n    return direct_linearize(traceable, primals, kwargs, has_aux=has_aux)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:261: in direct_linearize\n    ans = traceable.call_wrapped(*tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:90: in flatten_fun_nokwargs\n    ans = f(*py_args)\n          ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\njax/tests/experimental_rnn_test.py:65: in f\n    y, h, c = rnn.lstm(\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:749: in __call__\n    out_flat = custom_vjp_call_p.bind(flat_fun, flat_fwd, flat_bwd,\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:1007: in bind_with_trace\n    return trace.process_custom_vjp_call(self, fun, fwd, bwd, tracers, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/ad.py:979: in process_custom_vjp_call\n    res_and_primals_out = fwd.call_wrapped(*fwd_in_flat)\n                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/custom_derivatives.py:850: in _flatten_fwd\n    pair_out = f(*py_args)\n               ^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:292: in _argnums_partial\n    return _fun(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:425: in lstm_fwd\n    y, h_n, c_n, reserve_space = rnn_fwd_p.bind(\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:1189: in process_primitive\n    return primitive.impl(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:94: in apply_primitive\n    outs = fun(*args)\n           ^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:263: in cache_miss\n    executable, pgle_profiler, const_args) = _python_pjit_helper(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:136: in _python_pjit_helper\n    p, args_flat = _infer_params(fun, jit_info, args, kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:630: in _infer_params\n    return _infer_params_internal(fun, ji, args, kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:655: in _infer_params_internal\n    p, args_flat = _infer_params_impl(\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:551: in _infer_params_impl\n    jaxpr, consts, out_avals = _create_pjit_jaxpr(\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:496: in memoized_fun\n    ans = call(fun, *args)\n          ^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/pjit.py:1182: in _create_pjit_jaxpr\n    jaxpr, global_out_avals, consts = pe.trace_to_jaxpr_dynamic(fun, in_type)\n                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/profiler.py:359: in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2483: in trace_to_jaxpr_dynamic\n    ans = fun.call_wrapped(*in_tracers)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:212: in call_wrapped\n    return self.f_transformed(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/api_util.py:73: in flatten_fun\n    ans = f(*py_args, **py_kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/linear_util.py:421: in _get_result_paths_thunk\n    ans = _fun(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/dispatch.py:121: in prim_fun\n    return prim.bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:632: in bind\n    return self._true_bind(*args, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:648: in _true_bind\n    return self.bind_with_trace(prev_trace, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:660: in bind_with_trace\n    return trace.process_primitive(self, args, params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2175: in process_primitive\n    return self.default_process_primitive(\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2189: in default_process_primitive\n    out_avals, effs = _cached_abstract_eval(primitive, *aval_qdds, **params)\n                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:460: in wrapper\n    return cached_call(_multi_weakref_placeholder,\n/usr/local/lib/python3.12/dist-packages/jax/_src/util.py:444: in cache_miss\n    return call(*orig_args, **orig_kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/interpreters/partial_eval.py:2004: in _cached_abstract_eval\n    return primitive.abstract_eval(*aval_qdds, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n/usr/local/lib/python3.12/dist-packages/jax/_src/core.py:702: in abstract_eval_\n    return abstract_eval(*args, **kwargs), no_effects\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nx_aval = ShapedArray(float32[4,1,2]), h_0_aval = ShapedArray(float32[4,4,6])\nc_0_aval = ShapedArray(float32[4,4,6]), w_aval = ShapedArray(float32[1248])\nseq_lengths_aval = ShapedArray(int32[4]), input_size = 2, hidden_size = 6\nnum_layers = 4, dropout = False, bidirectional = False, cudnn_allow_tf32 = False\n\n    def rnn_abstract_eval(x_aval, h_0_aval, c_0_aval, w_aval, seq_lengths_aval,\n                          input_size: int, hidden_size: int, num_layers: int,\n                          dropout: float, bidirectional: bool,\n                          cudnn_allow_tf32: bool):\n      batch_size, max_seq_length = x_aval.shape[0], x_aval.shape[1]\n      num_directions = 2 if bidirectional else 1\n      output_shape = (batch_size, max_seq_length, num_directions * hidden_size)\n      output_aval = core.ShapedArray(output_shape, x_aval.dtype)\n      _, reserve_space_size = (\n>         gpu_rnn.compute_rnn_workspace_reserve_space_sizes(  # pytype: disable=attribute-error\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n              input_size, hidden_size, num_layers, batch_size, max_seq_length,\n              dropout, bidirectional, cudnn_allow_tf32))\nE     AttributeError: module 'jaxlib.gpu_rnn' has no attribute 'compute_rnn_workspace_reserve_space_sizes'\n\n/usr/local/lib/python3.12/dist-packages/jax/experimental/rnn.py:449: AttributeError"}, "teardown": {"duration": 0.00031462498009204865, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref0", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref0", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00029681622982025146, "outcome": "passed"}, "call": {"duration": 7.2073382418602705, "outcome": "passed"}, "teardown": {"duration": 0.00030512735247612, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref1", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref1", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.0004749055951833725, "outcome": "passed"}, "call": {"duration": 6.549257234670222, "outcome": "passed"}, "teardown": {"duration": 0.00018877536058425903, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref2", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref2", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.0002611987292766571, "outcome": "passed"}, "call": {"duration": 4.073464792221785, "outcome": "passed"}, "teardown": {"duration": 0.00015671923756599426, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref3", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref3", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00021251942962408066, "outcome": "passed"}, "call": {"duration": 2.4273323649540544, "outcome": "passed"}, "teardown": {"duration": 0.00014840811491012573, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref4", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref4", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00021489430218935013, "outcome": "passed"}, "call": {"duration": 5.082417878322303, "outcome": "passed"}, "teardown": {"duration": 0.00018521305173635483, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref5", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref5", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00025170017033815384, "outcome": "passed"}, "call": {"duration": 1.6153884986415505, "outcome": "passed"}, "teardown": {"duration": 0.00026713497936725616, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref6", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref6", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.0004226658493280411, "outcome": "passed"}, "call": {"duration": 10.86933827959001, "outcome": "passed"}, "teardown": {"duration": 0.00015196949243545532, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref7", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref7", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00021489523351192474, "outcome": "passed"}, "call": {"duration": 4.446905762888491, "outcome": "passed"}, "teardown": {"duration": 0.00023626536130905151, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref8", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref8", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00036211591213941574, "outcome": "passed"}, "call": {"duration": 12.554356252774596, "outcome": "passed"}, "teardown": {"duration": 0.00026713497936725616, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_lstm_ref9", "lineno": 117, "outcome": "passed", "keywords": ["test_lstm_ref9", "__wrapped__", "__x_params_repr__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.00040010828524827957, "outcome": "passed"}, "call": {"duration": 6.383905568160117, "outcome": "passed"}, "teardown": {"duration": 0.00030393991619348526, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_no_workspace_overflow", "lineno": 218, "outcome": "skipped", "keywords": ["test_no_workspace_overflow", "__wrapped__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.0004749055951833725, "outcome": "passed"}, "call": {"duration": 0.0009818682447075844, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 219, \"Skipped: test_no_workspace_overflow not supported on device with tags {'rocm', 'gpu'}.\")"}, "teardown": {"duration": 0.00021133292466402054, "outcome": "passed"}}, {"nodeid": "tests/experimental_rnn_test.py::RnnTest::test_struct_encoding_determinism", "lineno": 181, "outcome": "skipped", "keywords": ["test_struct_encoding_determinism", "__wrapped__", "RnnTest", "experimental_rnn_test.py", "tests", "jax", ""], "setup": {"duration": 0.000360928475856781, "outcome": "passed"}, "call": {"duration": 0.0007788455113768578, "outcome": "skipped", "longrepr": "('/dockerx/rocm/rocm-jax/jax/tests/experimental_rnn_test.py', 182, \"Skipped: test_struct_encoding_determinism not supported on device with tags {'rocm', 'gpu'}.\")"}, "teardown": {"duration": 0.0006268760189414024, "outcome": "passed"}}]}